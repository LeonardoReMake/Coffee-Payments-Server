# Тип проверки статуса заказа (polling / webhook / none)

## 1. Новое поле в Merchant Credentials

В структуру **Merchant Credentials** необходимо добавить новый параметр:

### `status_check_type`
Определяет способ получения статуса платежа. Возможные значения:

- **`polling`** — сервис сам опрашивает платёжную систему в фоне  
- **`webhook`** — статус заказа устанавливается по уведомлению от платёжной системы  
- **`none`** — статус заказа не проверяется автоматически никаким способом  

Поле хранится как отдельное поле структуры Merchant Credentials.

## 2. Новое поле в Order

В модель Order необходимо добавить параметр:
`status_check_type` — string
Хранит текущее значение способа проверки статуса, которое используется для этого заказа.
### Правило установки:
При создании платежа:
 - Берём status_check_type из Merchant Credentials для текущего Payment Scenario.
 - Сохраняем это значение в Order.status_check_type.

Это значение фиксируется для уже созданного заказа и не должно меняться, даже если Merchant Credentials изменятся позже.

## 3. Изменения в фоновой задаче Celery

При получении Orders, которые нужно проверить:

### Добавить фильтрацию:
В выборку должны попадать только те заказы, у которых:
 - Order.status = PENDING
 - Order.next_check_at < now (и не null)
 - Order.expires_at > now
 - Order.status_check_type = 'polling' ← новое условие

Только такие заказы могут участвовать в фоновых проверках платежей.
Другие типы:
 - Если status_check_type = 'webhook' — заказ не должен попадать в фоновую обработку
 - Если status_check_type = 'none' — заказ также не должен обрабатываться фоновым воркером

## 4. Обновить описание проекта в PROJECT.md
 - Обнови описание проекта в PROJECT.md
 - При разработки учитывай CONSTITUTUON.md
 - Не создавай дополнительных файлов описаний